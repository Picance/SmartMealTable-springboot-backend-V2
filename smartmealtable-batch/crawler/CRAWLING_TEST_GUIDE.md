# 실제 크롤링 테스트 가이드

서울과학기술대학교 노션 페이지를 실제로 크롤링하여 데이터를 검증하는 방법입니다.

## 🚀 빠른 실행

### 방법 1: ManualCrawlerTest 실행 (추천!)

가장 간단한 방법입니다. IDE에서 바로 실행할 수 있습니다.

#### IntelliJ IDEA
1. `ManualCrawlerTest.java` 파일 열기
2. `main()` 메서드 옆의 ▶️ 버튼 클릭
3. **"Run 'ManualCrawlerTest.main()'"** 선택

#### VS Code
1. `ManualCrawlerTest.java` 파일 열기
2. `main()` 메서드 위의 "Run" 링크 클릭

#### 명령줄
```bash
cd smartmealtable-batch/crawler
./run-crawler-test.sh
```

### 방법 2: JUnit 테스트 활성화

기존 테스트를 활성화하여 실행합니다.

1. **`SeoulTechCafeteriaServiceTest.java` 파일 열기**

2. **`@Disabled` 어노테이션 제거**
```java
@Test
// @Disabled("실제 노션 페이지 크롤링 테스트 - 수동 실행용")  ← 이 줄 삭제
@DisplayName("노션 페이지에서 학식 데이터를 크롤링한다")
void crawlCafeteriaData_Success() {
    // ...
}
```

3. **테스트 실행**
```bash
./gradlew :smartmealtable-batch:crawler:test --tests SeoulTechCafeteriaServiceTest
```

또는 IDE에서 테스트 메서드 실행

## 📊 예상 출력 결과

### ManualCrawlerTest 실행 시

```
========================================
서울과학기술대학교 학식 크롤링 테스트
========================================

크롤링 시작...
크롤링 완료!

✅ 크롤링 성공!
총 2개 건물 발견

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🏢 건물: ST: Table
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📍 주소: 서울 노원구 공릉로 232 1학생회관 1층
🌍 위치: 37.6335837919849, 127.07689204595525
🏪 가게 수: 5

  ┌─────────────────────────────────────
  │ 🍽️  가게: 값찌개
  │ 🏷️  카테고리: 한식
  │ 📋 메뉴 수: 10
  └─────────────────────────────────────
      💰 평균 가격: 6,500원

      메뉴 목록:
        • 김치찌개              6,000원
        • 된장찌개              6,000원
        • 제육볶음              7,000원
        ...

  ┌─────────────────────────────────────
  │ 🍽️  가게: 경성카츠
  │ 🏷️  카테고리: 일식
  │ 📋 메뉴 수: 5
  └─────────────────────────────────────
      💰 평균 가격: 7,200원

      메뉴 목록:
        • 돈까스                7,000원
        • 치킨까스              7,500원
        ...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🏢 건물: ST: Dining
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📍 주소: 서울 노원구 공릉로 232 2학생회관 1층
🌍 위치: 37.62985806656512, 127.07932350755101
🏪 가게 수: 5

  (가게 정보...)

========================================
📊 크롤링 통계
========================================
총 건물 수: 2
총 가게 수: 10
총 메뉴 수: 50

최저 가격: 5,000원
최고 가격: 9,000원
평균 가격: 6,800원
========================================
```

## 🔍 검증 체크리스트

크롤링이 성공적으로 작동하는지 확인하세요:

### ✅ 기본 검증
- [ ] 2개 건물 (ST: Table, ST: Dining) 크롤링됨
- [ ] 각 건물에 5개씩 가게 존재
- [ ] 모든 가게에 메뉴가 있음
- [ ] 모든 메뉴에 이름과 가격이 있음

### ✅ 데이터 검증
- [ ] 위도/경도 값이 정확함
- [ ] 주소가 올바름
- [ ] 카테고리가 올바르게 매핑됨 (한식, 중식, 일식, 양식, 아시안)
- [ ] 가격이 0보다 큼

### ✅ ST: Table 가게 목록
- [ ] 값찌개 (한식)
- [ ] 경성카츠 (일식)
- [ ] 바비든든 (한식)
- [ ] 포포420 (아시안)
- [ ] 뽀까뽀까 (한식)

### ✅ ST: Dining 가게 목록
- [ ] 값찌개 (한식) - 다른 지점
- [ ] 경성카츠 (일식) - 다른 지점
- [ ] 중식대장 (중식)
- [ ] 키친101 (양식)
- [ ] 플라잉팬 (한식)

## 🐛 문제 해결

### 크롤링 실패 시

#### 1. 네트워크 오류
```
오류: Connection timeout
```
**해결**: 인터넷 연결 확인, 방화벽 설정 확인

#### 2. 노션 페이지 구조 변경
```
오류: 메뉴를 찾을 수 없습니다
```
**해결**: 노션 페이지가 변경되었을 수 있습니다. `SeoulTechCafeteriaService.java`의 파싱 로직 수정 필요

#### 3. JSoup 의존성 오류
```
오류: ClassNotFoundException: org.jsoup.Jsoup
```
**해결**: 
```bash
./gradlew :smartmealtable-batch:crawler:clean
./gradlew :smartmealtable-batch:crawler:build
```

## 📝 실제 노션 페이지 확인

크롤링 대상 페이지: https://fern-magic-bde.notion.site/21e45244ac0a80fdb02ad064ce75d674

브라우저에서 직접 열어서 데이터 구조를 확인할 수 있습니다.

## 🔄 다음 단계

크롤링이 성공하면:

1. **통합 테스트 실행**
```bash
./gradlew :smartmealtable-batch:crawler:test
```

2. **전체 플로우 테스트 (DB 포함)**
```bash
# 데이터베이스 준비
mysql -u root -p < dml.sql

# 크롤러 실행
./gradlew :smartmealtable-batch:crawler:bootRun
```

3. **수동으로 크롤링 실행**
```bash
curl -X POST http://localhost:8080/api/crawler/execute
```

## 💡 팁

### 출력 결과 파일로 저장
```bash
# IDE에서 실행한 결과를 복사하거나
# 명령줄 실행 시 리다이렉트
./gradlew :smartmealtable-batch:crawler:test --tests ManualCrawlerTest > crawler-result.txt
```

### 디버깅 모드로 실행
IDE에서 브레이크포인트를 설정하고 디버그 모드로 실행하면:
- HTML 구조 확인
- 파싱 과정 단계별 확인
- 데이터 변환 과정 추적

가능합니다.

---

문제가 발생하면 크롤링 로그와 함께 문의하세요! 🚀

