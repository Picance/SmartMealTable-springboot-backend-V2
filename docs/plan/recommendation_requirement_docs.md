# 추천시스템 Requirement Docs
#Project/CapstoneDesign

## 알뜰식탁 추천 시스템 요구사항 명세서 (Requirement Document)

### 1. 개요 (Introduction)

본 문서는 "알뜰식탁" 서비스의 음식점 추천 시스템 기능 구현을 위한 요구사항을 기술합니다. 본 시스템은 사용자의 목표 식비, 활동 지역, 음식 선호도 등 개인화된 데이터를 기반으로 최적의 음식점을 추천하는 것을 목표로 합니다. 기존 추천 방식의 문제점을 개선하고 사용자 유형에 따라 더욱 다양한고 만족도 높은 추천을 제공하고자 합니다.

### 2. 기존 시스템 및 문제점 (Current System & Limitations)

#### 2.1. 기존 추천 방식
* **카테고리 벡터화:** 음식점의 카테고리를 벡터로 변환합니다.
* **코사인 유사도 계산:** 사용자 선호도 및 지출 내역을 기반으로 코사인 유사도를 계산하여 내림차순으로 음식점을 추천합니다.

#### 2.2. 문제점
* **추천 결과의 단조로움:** 매번 비슷한 음식점만 추천될 가능성이 높아 사용자가 새로운 선택을 하기 어렵습니다.
* **사용자 의도 미반영:** 사용자가 항상 가던 곳만 가기 위해 추천 서비스를 이용하는 것이 아니라는 점을 고려할 때, 기존 시스템은 다양한 경험을 원하는 사용자의 요구를 충족시키지 못합니다.

### 3. 제안 시스템 및 목표 (Proposed System & Goals)

#### 3.1. 변경된 추천 방식
사용자를 **절약형, 모험형, 균형형** 세 가지 유형으로 분류하고, 각 유형에 맞는 가중치를 부여하여 개인화된 추천 점수를 계산합니다. 이 방식은 안정성, 탐험성, 예산 효율성, 접근성이라는 네 가지 핵심 속성을 기반으로 합니다.

#### 3.2. 목표
* **개인화된 추천 제공:** 다양한 사용자 유형에 적합한 맞춤형 추천 방식을 제공합니다.
* **추천 다양성 확보:** 사용자가 새로운 맛집을 발견하는 즐거움을 느낄 수 있도록 탐험적 요소를 강화합니다.
* **사용자 만족도 증대:** 예산, 거리, 선호도 등 복합적인 요소를 고려하여 실질적으로 만족할 수 있는 음식점을 추천합니다.

### 4. 사용자 프로파일링 (User Profiling)

사용자는 음식 추천 유형 선택 화면에서 자신의 성향에 맞는 타입을 직접 선택합니다. 각 타입은 네 가지 속성에 대해 다음과 같은 가중치를 가집니다.

| 타입 | 안정성 | 탐험성 | 예산 효율성 | 접근성 | 특징 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **절약형** | 30% | 15% | 50% | 5% | 예산 준수와 검증된 선택을 선호 |
| **모험형** | 30% | 50% | 10% | 10% | 새로운 경험과 다양성을 추구 |
| **균형형** | 30% | 25% | 30% | 15% | 안정성과 탐험성의 조화를 원함 |

### 5. 핵심 기능 요구사항 (Functional Requirements)
추천 점수는 4가지 속성 점수의 가중합으로 계산됩니다. 각 속성 점수는 0~100으로 정규화(Normalization)됩니다.

`최종 추천 점수 = (안정성 점수 * w1) + (탐험성 점수 * w2) + (예산 효율성 점수 * w3) + (접근성 점수 * w4)`
*(w1~w4는 사용자 유형별 가중치)*

#### 5.1. 데이터 수치화 (Scoring)

* **정규화:** 서로 다른 척도(횟수, 금액, 거리 등)를 가진 데이터를 min-max 정규화를 통해 0~100 사이의 값으로 변환합니다.
  * `norm(x) = 100 * (x - min) / (max - min)`
  * 지출 내역과 같이 편차가 작은 데이터는 로그 스케일로 변환 후 정규화합니다.
* **데이터 부족 처리:** 신규 사용자 등 데이터가 부족한 경우(예: 최근 6개월 지출 3건 미만), 기본값 또는 전체 사용자 평균값으로 대체합니다.

#### 5.2. 속성별 점수 계산 로직

##### 5.2.1. 안정성 (Stability)
* **선호 카테고리 (40%):** 사용자가 설정한 카테고리 선호도('좋아요': 100점, '보통/중립': 0점, '싫어요': -100점)를 반영합니다.
* **과거 지출 기록 (40%):** 특정 카테고리에 지출한 금액이 전체 지출에서 차지하는 비율을 계산합니다. 오래된 기록의 영향력을 줄이기 위해 시간 감쇠(Time Decay) 함수를 적용합니다.
  * 가중 금액 `w = exp(-λ * days_ago)` 를 각 지출에 곱하여 합산합니다. (λ = 0.01)
* **리뷰 신뢰도 (20%):** 해당 음식점의 리뷰 수를 전체 리뷰 수와 비교하여 정규화한 점수를 반영합니다.

##### 5.2.2. 탐험성 (Exploration)
* **카테고리 신선도 (40%):** 최근(예: 30일)에 특정 카테고리를 얼마나 자주 방문했는지 계산하고, 그 비중의 역수(`1 - norm(recent_prop_c)`)를 신선도 점수로 사용합니다. (자주 안 간 카테고리일수록 점수 높음)
* **음식점 신규성 (30%):** 마지막 방문일이 오래되었거나, 아예 방문한 적이 없는 가게일수록 높은 점수를 부여합니다. 또한, 서비스에 등록된 지 얼마 안 된 신규 가게에도 높은 점수를 줍니다.
  * `restaurant_newness = 0.6 * (마지막 방문 후 경과일 점수) + 0.4 * (신규 등록 가게 점수)`
* **최근 관심도 (30%):** 최근 7일간의 가게 조회수(log 정규화)와 조회수 증가율을 조합하여 최근 인기가 많은 가게에 높은 점수를 부여합니다.
  * `recent_interest = 0.6 * norm_log(views_7) + 0.4 * clamp(norm(growth), 0, 100)`

##### 5.2.3. 예산 효율성 (Budget Efficiency)
* **가성비 (60%):** 가격 단위당 리뷰 수가 높은 곳을 '가성비'가 좋은 곳으로 판단합니다.
  * `v = log(1 + reviews) / avg_price` 공식을 사용해 점수를 계산하고 정규화합니다.
* **예산 대비 적정성 (40%):** 사용자가 설정한 식비 예산과 음식 가격을 비교하여, 예산을 초과할수록 감점합니다.
  * `1 - abs(expected_price - user_budget) / user_budget`

##### 5.2.4. 접근성 (Accessibility)
* **현재 위치로부터의 거리:** 사용자의 현재 위치와 음식점의 좌표를 Haversine 공식을 이용해 물리적 거리를 계산합니다.
* **점수 변환:** 거리가 가까울수록 점수가 높도록 정규화합니다.
  * `score = 1 - (d - d_min) / (d_max - d_min)`

---
### 6. 데이터 요구사항 (Data Requirements)

추천 시스템을 위해 아래와 같은 데이터가 수집 및 관리되어야 합니다.

* **음식점 정보:** ID, 이름, 카테고리, 주소, 좌표, 영업시간, 전화번호, 리뷰 수, 메뉴 정보(이름, 가격, 이미지), 조회수(view_count), 등록일(created_at)
* **사용자 정보:** 선호 카테고리(weight: 100/0/-100), 지출 내역(날짜, 금액, 가게), 활동 로그(조회 기록)
* **시스템 정보:** 전체 리뷰 수, 음식점별 평균 가격대
* **조회 이력:** store_view_history 테이블을 통한 가게별 조회 추적 (최근 7일 조회수 계산용)
* **임시 휴무:** store_temporary_closure 테이블을 통한 영업 상태 관리

### 7. 정규화 및 데이터 처리

#### 7.1 정규화 범위
* min-max 정규화는 현재 검색/필터링된 결과 집합 내에서 계산됩니다.
* 전체 가게 데이터가 아닌 조회 대상 가게들 사이에서 상대적 비교를 수행합니다.

#### 7.2 신규 사용자 처리 (Cold Start)
* **데이터 부족 기준**: 최근 6개월 지출 내역 < 3건
* **안정성 - 과거 지출**: 가중치를 0으로 설정, 선호 카테고리만 활용
* **탐험성 - 카테고리 신선도**: 모든 카테고리에 동일한 점수(50) 부여
* **탐험성 - 방문 기록**: 신규 가게 점수(100) 적용
* **예산 효율성**: 온보딩에서 설정한 예산 활용

#### 7.3 시간 감쇠 함수
* **λ (람다) 값**: 0.01
* **효과**: 약 100일 후 영향력 37%로 감소
* **적용 대상**: 과거 지출 기록의 가중치 계산

---

### 8. 추천 결과 필터 및 정렬

#### 8.1 위치 기반 필터
사용자가 선택할 수 있는 반경 필터 옵션:
* **0.5km 미만** (기본값)
* **1km 미만**
* **2km 미만**

위치 정보 우선순위:
1. 현재 GPS 위치 (실시간)
2. 등록된 주소 중 기본 주소 (is_primary = true)
3. 등록된 주소 중 가장 최근 주소

거리 계산은 Haversine 공식을 사용합니다.

#### 8.2 추가 필터
* **반경 거리**: 0.5km / 1km / 2km (기본값: 0.5km)
* **불호 음식**: 포함 / 제외 (기본값: 포함)
* **영업 시간**: 전체 / 영업 중만 (기본값: 전체)
* **학식/음식점**: 전체 / 학식만 / 음식점만 (기본값: 전체)

#### 8.3 정렬 옵션
* **기본 순**: 추천 점수 내림차순 (알고리즘)
* **가까운 순**: 거리 오름차순
* **리뷰 순**: review_count 내림차순
* **평균 가격 낮은 순**: average_price 오름차순
* **평균 가격 높은 순**: average_price 내림차순
* **즐겨찾기 많은 순**: favorite 테이블 COUNT 내림차순
* **관심도 높은 순**: view_count 내림차순
* **관심도 낮은 순**: view_count 오름차순

**참고**: 즐겨찾기 여부는 추천 알고리즘의 점수 계산에 영향을 주지 않으며, 추천과 즐겨찾기는 독립적으로 작동합니다.

