= SmartMealTable API Documentation
:doctype: book
:icons: font
:source-highlighter: highlightjs
:toc: left
:toclevels: 3
:sectlinks:

[[overview]]
= 개요

SmartMealTable API는 알뜰식탁 서비스의 백엔드 API입니다.

== API 서버 정보

|===
| 환경 | Base URL

| Production
| `https://api.smartmealtable.com`

| Staging
| `https://staging-api.smartmealtable.com`

| Development
| `http://localhost:8080`
|===

== 공통 응답 형식

모든 API는 다음과 같은 공통 응답 형식을 따릅니다.

=== 성공 응답

[source,json]
----
{
  "result": "SUCCESS",
  "data": { ... },
  "error": null
}
----

=== 에러 응답

[source,json]
----
{
  "result": "ERROR",
  "data": null,
  "error": {
    "code": "E400",
    "message": "에러 메시지",
    "data": { ... }
  }
}
----

== HTTP Status Codes

|===
| Status Code | Description

| `200 OK`
| 요청이 성공적으로 처리됨

| `201 Created`
| 리소스가 성공적으로 생성됨

| `400 Bad Request`
| 잘못된 요청

| `401 Unauthorized`
| 인증 실패

| `403 Forbidden`
| 권한 없음

| `404 Not Found`
| 리소스를 찾을 수 없음

| `409 Conflict`
| 리소스 충돌 (중복 등)

| `422 Unprocessable Entity`
| 유효성 검증 실패

| `500 Internal Server Error`
| 서버 내부 오류

| `503 Service Unavailable`
| 서비스 이용 불가
|===

[[auth]]
= 인증 (Authentication)

[[auth-signup]]
== 회원가입

=== 이메일 회원가입

`POST /api/v1/auth/signup/email`

이메일 주소를 사용하여 회원가입을 진행합니다.

==== 요청

include::{snippets}/auth/signup/email/success/http-request.adoc[]

===== 요청 필드

include::{snippets}/auth/signup/email/success/request-fields.adoc[]

==== 성공 응답 (201 Created)

include::{snippets}/auth/signup/email/success/http-response.adoc[]

===== 응답 필드

include::{snippets}/auth/signup/email/success/response-fields.adoc[]

==== 에러 응답

===== 이메일 중복 (409 Conflict)

include::{snippets}/auth/signup/email/duplicate-email/http-response.adoc[]

include::{snippets}/auth/signup/email/duplicate-email/response-fields.adoc[]

===== 유효성 검증 실패 (422 Unprocessable Entity)

include::{snippets}/auth/signup/email/validation-error/http-response.adoc[]

include::{snippets}/auth/signup/email/validation-error/response-fields.adoc[]

==== 유효성 규칙

* `name`: 2-50자
* `email`: 이메일 형식
* `password`: 8-20자, 영문+숫자+특수문자 조합

==== 예제

===== cURL

[source,bash]
----
curl -X POST https://api.smartmealtable.com/api/v1/auth/signup/email \
  -H "Content-Type: application/json" \
  -d '{
    "name": "홍길동",
    "email": "hong@example.com",
    "password": "SecureP@ss123!"
  }'
----

===== HTTPie

[source,bash]
----
http POST https://api.smartmealtable.com/api/v1/auth/signup/email \
  name="홍길동" \
  email="hong@example.com" \
  password="SecureP@ss123!"
----

[[onboarding]]
= 온보딩 (Onboarding)

회원가입 후 초기 설정 단계입니다. 프로필 설정 및 주소 등록을 포함합니다.

== 인증 요구사항

모든 온보딩 API는 JWT 인증이 필요합니다.

[source,http]
----
Authorization: Bearer {access_token}
----

[[onboarding-profile]]
== 프로필 설정

`POST /api/v1/onboarding/profile`

신규 회원의 닉네임과 소속 그룹을 설정합니다.

=== 요청

include::{snippets}/onboarding/profile/success/http-request.adoc[]

==== 요청 헤더

include::{snippets}/onboarding/profile/success/request-headers.adoc[]

==== 요청 필드

include::{snippets}/onboarding/profile/success/request-fields.adoc[]

=== 성공 응답 (200 OK)

include::{snippets}/onboarding/profile/success/http-response.adoc[]

==== 응답 필드

include::{snippets}/onboarding/profile/success/response-fields.adoc[]

=== 에러 응답

==== 닉네임 중복 (409 Conflict)

include::{snippets}/onboarding/profile/fail-duplicate-nickname/http-response.adoc[]

include::{snippets}/onboarding/profile/fail-duplicate-nickname/response-fields.adoc[]

==== 그룹 미존재 (404 Not Found)

include::{snippets}/onboarding/profile/fail-group-not-found/http-response.adoc[]

include::{snippets}/onboarding/profile/fail-group-not-found/response-fields.adoc[]

=== 예제

==== cURL

[source,bash]
----
curl -X POST https://api.smartmealtable.com/api/v1/onboarding/profile \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Content-Type: application/json" \
  -d '{
    "nickname": "길동이",
    "groupId": 1
  }'
----

[[onboarding-address]]
== 주소 등록

`POST /api/v1/onboarding/address`

회원의 주소를 등록합니다. 주 거주지(Primary) 또는 부 거주지(Non-Primary)로 설정할 수 있습니다.

=== 요청 (주 거주지)

include::{snippets}/onboarding/address/register-success-primary/http-request.adoc[]

==== 요청 헤더

include::{snippets}/onboarding/address/register-success-primary/request-headers.adoc[]

==== 요청 필드

include::{snippets}/onboarding/address/register-success-primary/request-fields.adoc[]

=== 성공 응답 (201 Created)

include::{snippets}/onboarding/address/register-success-primary/http-response.adoc[]

==== 응답 필드

include::{snippets}/onboarding/address/register-success-primary/response-fields.adoc[]

=== 에러 응답

==== 필수 필드 누락 (422 Unprocessable Entity)

include::{snippets}/onboarding/address/fail-missing-fields/http-response.adoc[]

include::{snippets}/onboarding/address/fail-missing-fields/response-fields.adoc[]

==== 주소 길이 초과 (422 Unprocessable Entity)

include::{snippets}/onboarding/address/fail-address-too-long/http-response.adoc[]

include::{snippets}/onboarding/address/fail-address-too-long/response-fields.adoc[]

==== JWT 토큰 누락 (400 Bad Request)

include::{snippets}/onboarding/address/fail-missing-jwt/http-response.adoc[]

include::{snippets}/onboarding/address/fail-missing-jwt/response-fields.adoc[]

==== 잘못된 JWT 토큰 (400 Bad Request)

include::{snippets}/onboarding/address/fail-invalid-jwt/http-response.adoc[]

include::{snippets}/onboarding/address/fail-invalid-jwt/response-fields.adoc[]

=== 예제

==== cURL (주 거주지)

[source,bash]
----
curl -X POST https://api.smartmealtable.com/api/v1/onboarding/address \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Content-Type: application/json" \
  -d '{
    "alias": "집",
    "lotNumberAddress": "서울특별시 강남구 테헤란로 123",
    "streetNameAddress": "서울특별시 강남구 테헤란로 427",
    "detailedAddress": "위워크 삼성역점 10층",
    "latitude": 37.5081,
    "longitude": 127.0630,
    "addressType": "HOME",
    "isPrimary": true
  }'
----

==== cURL (부 거주지)

[source,bash]
----
curl -X POST https://api.smartmealtable.com/api/v1/onboarding/address \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Content-Type: application/json" \
  -d '{
    "alias": "회사",
    "streetNameAddress": "서울특별시 송파구 올림픽로 300",
    "detailedAddress": "롯데월드타워 35층",
    "latitude": 37.5125,
    "longitude": 127.1025,
    "addressType": "WORK",
    "isPrimary": false
  }'
----

[[onboarding-budget]]
== 예산 설정

온보딩 과정에서 사용자의 월별/일일/식사별 예산을 설정합니다.

=== 요청

include::{snippets}/onboarding-budget-set-success/http-request.adoc[]

==== 요청 헤더

include::{snippets}/onboarding-budget-set-success/request-headers.adoc[]

==== 요청 필드

include::{snippets}/onboarding-budget-set-success/request-fields.adoc[]

=== 성공 응답 (201 Created)

include::{snippets}/onboarding-budget-set-success/http-response.adoc[]

==== 응답 필드

include::{snippets}/onboarding-budget-set-success/response-fields.adoc[]

=== 에러 응답

==== 필수 필드 누락 (422 Unprocessable Entity)

include::{snippets}/onboarding-budget-set-validation-error/http-response.adoc[]

include::{snippets}/onboarding-budget-set-validation-error/response-fields.adoc[]

==== JWT 토큰 누락 (400 Bad Request)

include::{snippets}/onboarding-budget-set-auth-error/http-response.adoc[]

include::{snippets}/onboarding-budget-set-auth-error/response-fields.adoc[]

=== 예제

==== cURL

[source,bash]
----
curl -X POST https://api.smartmealtable.com/api/v1/onboarding/budget \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Content-Type: application/json" \
  -d '{
    "monthlyBudget": 300000,
    "dailyBudget": 10000,
    "mealBudgets": {
      "BREAKFAST": 3000,
      "LUNCH": 5000,
      "DINNER": 7000
    }
  }'
----

[[store]]
= 식당 조회 (Store)

식당 목록 조회, 상세 정보 조회, 자동완성 검색 기능을 제공합니다.

== 인증 요구사항

모든 식당 API는 JWT 인증이 필요합니다.

[source,http]
----
Authorization: Bearer {access_token}
----

[[store-list]]
== 식당 목록 조회

`GET /api/v1/stores`

주변 식당 목록을 조회합니다. 기본적으로 3km 반경 내 식당을 검색하며, 키워드 검색, 정렬, 페이징을 지원합니다.

=== 요청 (기본 반경)

include::{snippets}/store-list-default/http-request.adoc[]

==== 요청 헤더

include::{snippets}/store-list-default/request-headers.adoc[]

==== 요청 파라미터

include::{snippets}/store-list-default/query-parameters.adoc[]

=== 성공 응답 (200 OK)

include::{snippets}/store-list-default/http-response.adoc[]

==== 응답 필드

include::{snippets}/store-list-default/response-fields.adoc[]

=== 키워드 검색

식당 이름 또는 카테고리로 검색할 수 있습니다.

==== 요청

include::{snippets}/store-list-search/http-request.adoc[]

==== 응답

include::{snippets}/store-list-search/http-response.adoc[]

=== 정렬 옵션

* `DISTANCE_ASC`: 거리순 (가까운 순)
* `REVIEW_COUNT_DESC`: 리뷰 많은 순
* `VIEW_COUNT_DESC`: 조회수 많은 순
* `AVERAGE_PRICE_ASC`: 가격 낮은 순
* `AVERAGE_PRICE_DESC`: 가격 높은 순

=== 예제

==== cURL (기본 조회)

[source,bash]
----
curl -X GET 'https://api.smartmealtable.com/api/v1/stores?latitude=37.5081&longitude=127.0630' \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
----

==== cURL (키워드 검색)

[source,bash]
----
curl -X GET 'https://api.smartmealtable.com/api/v1/stores?latitude=37.5081&longitude=127.0630&keyword=삼겹살&sortBy=REVIEW_COUNT_DESC&page=0&size=20' \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
----

[[store-detail]]
== 식당 상세 조회

`GET /api/v1/stores/{storeId}`

특정 식당의 상세 정보를 조회합니다. 영업시간, 임시 휴무 정보, 즐겨찾기 여부 등을 포함합니다.

=== 요청

include::{snippets}/store-detail-success/http-request.adoc[]

==== 경로 파라미터

include::{snippets}/store-detail-success/path-parameters.adoc[]

==== 요청 헤더

include::{snippets}/store-detail-success/request-headers.adoc[]

=== 성공 응답 (200 OK)

include::{snippets}/store-detail-success/http-response.adoc[]

==== 응답 필드

include::{snippets}/store-detail-success/response-fields.adoc[]

=== 영업시간 정보

* `dayOfWeek`: 요일 (MONDAY, TUESDAY, ..., SUNDAY)
* `isHoliday`: 정기 휴무일 여부
* `openTime`, `closeTime`: 영업시간 (정기 휴무일인 경우 null)
* `breakStartTime`, `breakEndTime`: 브레이크타임 (선택적)

=== 예제

==== cURL

[source,bash]
----
curl -X GET https://api.smartmealtable.com/api/v1/stores/1 \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
----

[[store-autocomplete]]
== 식당 자동완성 검색

`GET /api/v1/stores/autocomplete`

식당 이름 자동완성을 위한 API입니다. 입력한 키워드로 시작하는 식당을 빠르게 검색합니다. 인증이 필요 없는 공개 API입니다.

=== 요청

include::{snippets}/store-autocomplete-success/http-request.adoc[]

==== 요청 파라미터

include::{snippets}/store-autocomplete-success/query-parameters.adoc[]

=== 성공 응답 (200 OK)

include::{snippets}/store-autocomplete-success/http-response.adoc[]

==== 응답 필드

include::{snippets}/store-autocomplete-success/response-fields.adoc[]

=== 예제

==== cURL

[source,bash]
----
curl -X GET 'https://api.smartmealtable.com/api/v1/stores/autocomplete?keyword=강남&limit=5' \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
----

==== HTTPie

[source,bash]
----
http GET 'https://api.smartmealtable.com/api/v1/stores/autocomplete?keyword=강남&limit=5' \
  Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
----

